<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="iOS Combine：核心概念" /><meta property="og:locale" content="en" /><meta name="description" content="Combine 是 iOS13 新加入的库，它的出现主要是为了解决当前我们在进行异步编程时遇到的痛点，各种 Delegate, Callback, Notification 混杂在我们的 App 中，导致异步事件混乱，难以调试代码，下图展示了当前常用的异步 API：" /><meta property="og:description" content="Combine 是 iOS13 新加入的库，它的出现主要是为了解决当前我们在进行异步编程时遇到的痛点，各种 Delegate, Callback, Notification 混杂在我们的 App 中，导致异步事件混乱，难以调试代码，下图展示了当前常用的异步 API：" /><link rel="canonical" href="https://zhiying-fan.github.io//posts/ios-combine-core-concepts/" /><meta property="og:url" content="https://zhiying-fan.github.io//posts/ios-combine-core-concepts/" /><meta property="og:site_name" content="Zhiying’s iOS Star" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-05T20:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="iOS Combine：核心概念" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="LuCYo62lEM-iH8hHdGrT5tKB0ZaRWeUFbWhPBJbVi70" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-07-05T20:00:00+08:00","datePublished":"2021-07-05T20:00:00+08:00","description":"Combine 是 iOS13 新加入的库，它的出现主要是为了解决当前我们在进行异步编程时遇到的痛点，各种 Delegate, Callback, Notification 混杂在我们的 App 中，导致异步事件混乱，难以调试代码，下图展示了当前常用的异步 API：","headline":"iOS Combine：核心概念","mainEntityOfPage":{"@type":"WebPage","@id":"https://zhiying-fan.github.io//posts/ios-combine-core-concepts/"},"url":"https://zhiying-fan.github.io//posts/ios-combine-core-concepts/"}</script><title>iOS Combine：核心概念 | Zhiying's iOS Star</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Zhiying's iOS Star"><meta name="application-name" content="Zhiying's iOS Star"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Zhiying's iOS Star</a></div><div class="site-subtitle font-italic">一个安静的知识星球</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/zhiying-fan" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['fanzhiying1992','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>iOS Combine：核心概念</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img data-src="/assets/img/post/combine/header.jpeg" class="preview-img bg" alt="Preview Image" data-proofer-ignore><h1 data-toc-skip>iOS Combine：核心概念</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/zhiying-fan">Zhiying Fan</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1625486400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2021-07-05 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4194 words"> <em>23 min</em> read</span></div></div></div><div class="post-content"><p><a href="https://developer.apple.com/documentation/combine">Combine</a> 是 iOS13 新加入的库，它的出现主要是为了解决当前我们在进行异步编程时遇到的痛点，各种 Delegate, Callback, Notification 混杂在我们的 App 中，导致异步事件混乱，难以调试代码，下图展示了当前常用的异步 API：</p><p><img data-src="/assets/img/post/combine/async-event.png" alt="async-event" data-proofer-ignore> <em>本图片来自 Combine 书籍</em></p><p>Combine 和 RxSwift 中的核心思想和概念是一致的，所以如果你使用过 RxSwift，那么学习并使用 Combine 对你来说将是轻而易举的。</p><h2 id="核心"><span class="mr-2">核心</span><a href="#核心" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Combine 的核心是 Publisher, Operator 和 Subscriber。</p><p>Publisher：负责发送消息</p><p>Operator：负责对消息进行处理，比如 map, filter 等</p><p>Subscriber：接收消息进行消费</p><p>大概流程如下图：</p><p><img data-src="/assets/img/post/combine/process.jpg" alt="process" data-proofer-ignore> <em>本图中的素材来自 Combine 书籍</em></p><p>从 Publisher 到 Operator 再到 Subscriber 的调用是链式的，Operator 的输入是 Publisher，输出仍然是 Publisher，得益于 Operator 的高度解耦，我们可以对数据进行多次处理，并且对其的测试也是比较容易的。</p><p>下面分别对 Combine 中的几个核心概念进行说明，以下内容翻译自 <a href="https://heckj.github.io/swiftui-notes/#coreconcepts">Using Combine</a></p><h2 id="publisher-and-subscriber"><span class="mr-2">Publisher and Subscriber</span><a href="#publisher-and-subscriber" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>两个关键概念，<a href="https://developer.apple.com/documentation/combine/publisher">publisher</a> 和 <a href="https://developer.apple.com/documentation/combine/subscriber">subscriber</a>，在 Swift 中被描述为协议。</p><p>当你谈论编程（尤其是 Swift 和 Combine）时，类型描述了很多。 当你说一个函数或方法返回一个值时，该值通常被描述为“此类型之一”。</p><p>Combine 就是定义随着时间的推移使用许多可能的值进行操作的过程。 Combine 还不仅仅是定义结果，它还定义了我们如何处理失败。 它不仅讨论可以返回的类型，还讨论可能发生的失败。</p><p>现在我们要引入的第一个核心概念是发布者。 当其被订阅之后，根据请求会提供数据， 没有任何订阅请求的发布者不会提供任何数据。 当你表达一个 Combine 的发布者时，应该用两种相关的类型来描述它：一种用于输出，一种用于失败。</p><p><img data-src="/assets/img/post/combine/basic-types.svg" alt="basic-types" data-proofer-ignore></p><p>这些通常使用泛型语法编写，该语法在描述类型的文本周围使用<code class="language-plaintext highlighter-rouge">&lt;</code> 和 <code class="language-plaintext highlighter-rouge">&gt;</code> 符号。这表示我们正在谈论这种类型的值的通用实例。例如，如果发布者返回了一个 <code class="language-plaintext highlighter-rouge">String</code> 类型的实例，并且可能以 <code class="language-plaintext highlighter-rouge">URLError</code> 实例的形式返回失败，那么发布者可能会用 <code class="language-plaintext highlighter-rouge">&lt;String, URLError&gt;</code> 来描述。</p><p>与发布者匹配的对应概念是订阅者，是第二个要介绍的核心概念。</p><p>订阅者负责请求数据并接受发布者提供的数据（和可能的失败）。 订阅者同样被描述为两种关联类型，一种用于输入，一种用于失败。 订阅者发起数据请求，并控制它接收的数据量。 它可以被认为是在 Combine 中起“驱动作用”的，因为如果没有订阅者，其他组件将保持闲置状态，没有数据会流动起来。</p><p>发布者和订阅者是相互连接的，它们构成了 Combine 的核心。 当你将订阅者连接到发布者时，两种类型都必须匹配：发布者的输出和订阅者的输入以及它们的失败类型。 将其可视化的一种方法是对两种类型进行一系列并行操作，其中两种类型都需要匹配才能将组件插入在一起。</p><p><img data-src="/assets/img/post/combine/input-output.svg" alt="input-output" data-proofer-ignore></p><p>第三个核心概念是操作符——一个既像订阅者又像发布者的对象。操作符是同时实现了<a href="https://developer.apple.com/documentation/combine/subscriber">订阅者协议</a>和<a href="https://developer.apple.com/documentation/combine/publisher">发布者协议</a>的类。 它们支持订阅发布者，并将结果发送给任何订阅者。</p><p>你可以用这些创建成链，用于处理和转换发布者提供的数据和订阅者请求的数据。我称这些组合序列为<strong>管道</strong>。</p><p><img data-src="/assets/img/post/combine/pipeline.svg" alt="pipeline" data-proofer-ignore></p><p>操作符可用于转换值或类型 - 输出和失败类型都可以。 操作符还可以拆分或复制流，或将流合并在一起。 操作符必须始终按输出/失败这样的类型组合对齐。 编译器将强制执行匹配类型，因此错误将导致编译器错误（如果幸运的话，会有一个有用的 <em>fixit</em> 片段建议给你解决方案）。</p><p>用 swift 编写的简单的 Combine 管道如下所示：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">value</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="nf">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1">// do something with the incoming value here</span>
        <span class="c1">// and return a string</span>
        <span class="k">return</span> <span class="s">"a string"</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">receivedValue</span> <span class="nf">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1">// sink is the subscriber and terminates the pipeline</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"The end result was </span><span class="se">\(</span><span class="n">receivedValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
</pre></table></code></div></div><ol><li>管道从发布者 <code class="language-plaintext highlighter-rouge">Just</code> 开始，它用它定义的值（在本例中为整数 <code class="language-plaintext highlighter-rouge">5</code>）进行响应。输出类型为 <code class="language-plaintext highlighter-rouge">&lt;Integer&gt;</code>，失败类型为 <code class="language-plaintext highlighter-rouge">&lt;Never&gt;</code>。<li>然后管道有一个 <code class="language-plaintext highlighter-rouge">map</code> 操作符，它在转换值及其类型。 在此示例中，它忽略了发布者发出的输入并返回了一个字符串。 这也将输出类型转换为 <code class="language-plaintext highlighter-rouge">&lt;String&gt;</code>，并将失败类型仍然保持为 <code class="language-plaintext highlighter-rouge">&lt;Never&gt;</code>。<li>然后管道以 <code class="language-plaintext highlighter-rouge">sink</code> 订阅者结束。</ol><p>当你去尝试理解管道时，你可以将其视为由输出和失败类型链接的一系列操作。 当你开始构建自己的管道时，这种模式就会派上用场。 创建管道时，你可以选择操作符来帮助你转换数据、类型或两者同时使用以实现最终目的。 最终目标可能是启用或禁用用户界面的某个元素，或者可能是得到某些数据用来显示。 许多 Combine 的操作符专门设计用来做这些转换。</p><p>有许多操作符是以 <code class="language-plaintext highlighter-rouge">try</code> 为前缀的，这表示它们返回一个 <code class="language-plaintext highlighter-rouge">&lt;Error&gt;</code> 的失败类型。 例如 <a href="https://heckj.github.io/swiftui-notes/#reference-map">map</a> 和 <a href="https://heckj.github.io/swiftui-notes/#reference-trymap">tryMap</a>。 <code class="language-plaintext highlighter-rouge">map</code> 操作符可以转换输出和失败类型的任意组合。 <code class="language-plaintext highlighter-rouge">tryMap</code> 接受任何输入和失败类型，并允许输出任何类型，但始终会输出 <code class="language-plaintext highlighter-rouge">&lt;Error&gt;</code> 的失败类型。</p><p>像 <code class="language-plaintext highlighter-rouge">map</code> 这样的操作符，你在定义返回的输出类型时，允许你通过基于你在提供给操作符的闭包中返回的内容推断输出类型。 在上面的例子中，<code class="language-plaintext highlighter-rouge">map</code> 操作符返回一个 <code class="language-plaintext highlighter-rouge">String</code> 的输出类型，因为这正是闭包返回的类型。</p><p>为了更具体地说明更改类型的示例，我们扩展了值在传输过程中的转换逻辑。此示例仍然以提供类型 <code class="language-plaintext highlighter-rouge">&lt;Int, Never&gt;</code> 的发布者开始，并以订阅类型为 <code class="language-plaintext highlighter-rouge">&lt;String, Never&gt;</code> 的值结束。</p><p><a href="https://github.com/heckj/swiftui-notes/blob/master/SwiftUI-NotesTests/CombinePatternTests.swift">SwiftUI-NotesTests/CombinePatternTests.swift</a></p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">value</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span> <span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span>
        <span class="k">switch</span> <span class="n">value</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"none"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"one"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"couple"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"few"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"many"</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"some"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">receivedValue</span> <span class="k">in</span> <span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"The end result was </span><span class="se">\(</span><span class="n">receivedValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
</pre></table></code></div></div><ol><li>Just 是创建一个 <code class="language-plaintext highlighter-rouge">&lt;Int, Never&gt;</code> 类型组合的发布者，提供单个值然后完成。<li>提供给 <code class="language-plaintext highlighter-rouge">.map()</code> 函数的闭包接受一个 <code class="language-plaintext highlighter-rouge">&lt;Int&gt;</code> 并将其转换为一个 <code class="language-plaintext highlighter-rouge">&lt;String&gt;</code>。由于 <code class="language-plaintext highlighter-rouge">&lt;Never&gt;</code> 的失败类型没有被改变，所以就直接输出了。<li><code class="language-plaintext highlighter-rouge">sink</code> 作为订阅者，接受 <code class="language-plaintext highlighter-rouge">&lt;String, Never&gt;</code> 类型的组合数据。</ol><blockquote><p>当你在 Xcode 中创建管道，类型不匹配时，Xcode 中的错误消息可能包含一个有用的修复建议 <em>fixit</em>。 在某些情况下，例如上个例子，当提供给 <code class="language-plaintext highlighter-rouge">map</code> 的闭包中不指定特定的返回类型时，编译器就无法推断其返回值类型。 Xcode (11 beta 2 and beta 3) 显示此为错误消息： <code class="language-plaintext highlighter-rouge">Unable to infer complex closure return type; add explicit type to disambiguate</code>。 在上面示例中，我们用 <code class="language-plaintext highlighter-rouge">value → String in</code> 明确指定了返回的类型。</p></blockquote><p>你可以将 Combine 的发布者、操作符和订阅者视为具有两种需要对齐的平行类型 —— 一种用于成功的有用值，另一种用于错误处理。 设计管道时经常会选择如何转换其中一种或两种类型以及与之相关的数据。</p><h2 id="发布者和订阅者的生命周期"><span class="mr-2">发布者和订阅者的生命周期</span><a href="#发布者和订阅者的生命周期" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>订阅者和发布者以明确定义的顺序进行通信，因此使得它们具有从开始到结束的生命周期：</p><p><img data-src="/assets/img/post/combine/lifecycle-diagram.svg" alt="lifecycle-diagram" data-proofer-ignore></p><p><em>一个 Combine 管道的生命周期</em></p><ol><li>当调用 <code class="language-plaintext highlighter-rouge">.subscribe(_: Subscriber)</code> 时，订阅者被连接到了发布者。<li>发布者随后调用 <code class="language-plaintext highlighter-rouge">receive(subscription: Subscription)</code> 来确认该订阅。<li>在订阅被确认后，订阅者请求值 <em>N</em>，此时调用 <code class="language-plaintext highlighter-rouge">request(_: Demand)</code>。<li>发布者可能随后（当它有值时）发送 <em>N</em> 或者更少的值，通过调用 <code class="language-plaintext highlighter-rouge">receive(_: Input)</code>。 发布者不会发送<strong>超过</strong>需求量的值。<li>订阅确认后的任何时间，订阅者都可能调用 <code class="language-plaintext highlighter-rouge">.cancel()</code> 来发送 <a href="https://developer.apple.com/documentation/combine/subscribers/completion">cancellation</a><li>发布者可以选择性地发送 <a href="https://developer.apple.com/documentation/combine/subscribers/completion">completion</a>：<code class="language-plaintext highlighter-rouge">receive(completion:)</code>。 完成可以是正常终止，也可以是通过 <code class="language-plaintext highlighter-rouge">.failure</code> 完成，可选地传递一个错误类型。 已取消的管道不会发送任何完成事件。</ol><p>在上述图表中包含了一组堆积起来的弹珠图， 这是为了突出 Combine 的弹珠图在管道的整体生命周期中的重点。 通常，图表推断所有的连接配置都已完成并已发送了数据请求。 Combine 的弹珠图的核心是从请求数据到触发任何完成或取消之间的一系列事件。</p><h2 id="发布者"><span class="mr-2">发布者</span><a href="#发布者" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>发布者是数据的提供者。 当订阅者请求数据时， <a href="https://developer.apple.com/documentation/combine/publisher">publisher protocol</a> 有严格的返回值类型约定，并有一系列明确的完成信号可能会终止它。</p><p>你可以从 <a href="https://heckj.github.io/swiftui-notes/#reference-just">Just</a> 和 <a href="https://heckj.github.io/swiftui-notes/#reference-future">Future</a> 开始使用发布者，它们分别作为单一数据源和异步函数来使用。</p><p>当订阅者发出请求时，许多发布者会立即提供数据。 在某些情况下，发布者可能有一个单独的机制，使其能够在订阅后返回数据。 这是由协议 <a href="https://developer.apple.com/documentation/combine/connectablepublisher">ConnectablePublisher</a> 来约定实现的。 遵循 <code class="language-plaintext highlighter-rouge">ConnectablePublisher</code> 的发布者将有一个额外的机制，在订阅者发出请求后才启动数据流。 这可能是对发布者单独的调用 <code class="language-plaintext highlighter-rouge">.connect()</code> 来完成。 另一种可能是 <code class="language-plaintext highlighter-rouge">.autoconnect()</code>，一旦订阅者请求，它将立即启动数据流。</p><p>Combine 提供了一些额外的便捷的发布者：</p><div class="table-wrapper"><table><thead><tr><th>Convenience publishers<th> <th> <tbody><tr><td><a href="https://heckj.github.io/swiftui-notes/#reference-just">Just</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-future">Future</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-deferred">Deferred</a><tr><td><a href="https://heckj.github.io/swiftui-notes/#reference-empty">Empty</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-sequence">Sequence</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-fail">Fail</a><tr><td><a href="https://heckj.github.io/swiftui-notes/#reference-record">Record</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-share">Share</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-multicast">Multicast</a><tr><td><a href="https://heckj.github.io/swiftui-notes/#reference-observableobject">ObservableObject</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-published">@Published</a><td> </table></div><p>Combine 之外的一些苹果的 API 也提供发布者。</p><ul><li><a href="https://heckj.github.io/swiftui-notes/#reference-swiftui">SwiftUI</a> 使用 <code class="language-plaintext highlighter-rouge">@Published</code> 和 <code class="language-plaintext highlighter-rouge">@ObservedObject</code> 属性包装，由 Combine 提供，含蓄地创建了一个发布者，用来支持它的声明式 UI 的机制。<li>Foundation<ul><li><a href="https://heckj.github.io/swiftui-notes/#reference-datataskpublisher">URLSession.dataTaskPublisher</a><li><a href="https://heckj.github.io/swiftui-notes/#reference-kvo-publisher">.publisher on KVO instance</a><li><a href="https://heckj.github.io/swiftui-notes/#reference-notificationcenter">NotificationCenter</a><li><a href="https://heckj.github.io/swiftui-notes/#reference-timer">Timer</a><li><a href="https://heckj.github.io/swiftui-notes/#reference-result">Result</a></ul></ul><h2 id="操作符"><span class="mr-2">操作符</span><a href="#操作符" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>操作符是苹果参考文档中包含的一些预构建功能的便捷名称。 操作符用来组合成管道。 许多操作符会接受开发人员的一个或多个闭包，以定义业务逻辑，同时保持并持有发布者/订阅者的生命周期。</p><p>一些操作符支持合并来自不同管道的输出、更改数据的时序或过滤所提供的数据。 操作符可能还会对操作类型有限制， 还可用于定义错误处理和重试逻辑、缓冲和预先载入以及支持调试。</p><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Mapping elements<th> <th> <tbody><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-scan">scan</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-tryscan">tryScan</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-setfailuretype">setFailureType</a><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-map">map</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-trymap">tryMap</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-flatmap">flatMap</a></table></div><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Filtering elements<th> <th> <tbody><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-compactmap">compactMap</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-trycompactmap">tryCompactMap</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-replaceempty">replaceEmpty</a><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-filter">filter</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-tryfilter">tryFilter</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-replaceerror">replaceError</a><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-removeduplicates">removeDuplicates</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-tryremoveduplicates">tryRemoveDuplicates</a><td> </table></div><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Reducing elements<th> <th> <tbody><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-collect">collect</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-reduce">reduce</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-tryreduce">tryReduce</a><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-ignoreoutput">ignoreOutput</a><td> <td> </table></div><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Mathematic operations on elements<th> <th> <tbody><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-max">max</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-trymax">tryMax</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-count">count</a><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-min">min</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-min">tryMin</a><td> </table></div><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Applying matching criteria to elements<th> <th> <tbody><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-allsatisfy">allSatisfy</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-tryallsatisfy">tryAllSatisfy</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-contains">contains</a><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-containswhere">containsWhere</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-trycontainswhere">tryContainsWhere</a><td> </table></div><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Applying sequence operations to elements<th> <th> <tbody><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-firstwhere">firstWhere</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-tryfirstwhere">tryFirstWhere</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-first">first</a><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-lastwhere">lastWhere</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-trylastwhere">tryLastWhere</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-last">last</a><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-dropwhile">dropWhile</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-trydropwhile">tryDropWhile</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-dropuntiloutput">dropUntilOutput</a><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-prepend">prepend</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-drop">drop</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-prefixuntiloutput">prefixUntilOutput</a><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-prefixwhile">prefixWhile</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-tryprefixwhile">tryPrefixWhile</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-output">output</a></table></div><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Combining elements from multiple publishers<th> <th> <tbody><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-combinelatest">combineLatest</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-merge">merge</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-zip">zip</a></table></div><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Handling errors<th> <th> <tbody><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-catch">catch</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-trycatch">tryCatch</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-assertnofailure">assertNoFailure</a><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-retry">retry</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-maperror">mapError</a><td> </table></div><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Adapting publisher types<th> <th> <tbody><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-switchtolatest">switchToLatest</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-erasetoanypublisher">eraseToAnyPublisher</a><td> </table></div><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Controlling timing<th> <th> <tbody><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-debounce">debounce</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-delay">delay</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-measureinterval">measureInterval</a><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-throttle">throttle</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-timeout">timeout</a><td> </table></div><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Encoding and decoding<th> <th> <tbody><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-encode">encode</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-decode">decode</a><td> </table></div><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Working with multiple subscribers<th> <th> <tbody><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-multicast">multicast</a><td> <td> </table></div><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Debugging<th> <th> <tbody><tr><td style="text-align: center"><a href="https://heckj.github.io/swiftui-notes/#reference-breakpoint">breakpoint</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-handleevents">handleEvents</a><td><a href="https://heckj.github.io/swiftui-notes/#reference-print">print</a></table></div><h2 id="subjects"><span class="mr-2">Subjects</span><a href="#subjects" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Subjects 是一种遵循 <a href="https://developer.apple.com/documentation/combine/subject"><code class="language-plaintext highlighter-rouge">Subject</code></a> 协议的特殊的发布者。 这个协议要求 subjects 有一个 <code class="language-plaintext highlighter-rouge">.send(_:)</code> 方法，来允许开发者发送特定的值给订阅者或管道。</p><p>Subjects 可以通过调用 <code class="language-plaintext highlighter-rouge">.send(_:)</code> 方法来将值“注入”到流中， 这对于将现有的命令式的代码与 Combine 集成非常有用。</p><p>一个 subject 还可以向多个订阅者广播消息。 如果多个订阅者连接到一个 subject，它将在调用 <code class="language-plaintext highlighter-rouge">send(_:)</code> 时向多个订阅者发送值。 一个 subject 还经常用于连接或串联多个管道，特别是同时给多个管道发送值时。</p><p>Subject 不会盲目地传递其订阅者的需求。 相反，它为需求提供了一个聚合点。 在没有收到订阅消息之前，一个 subject 不会向其连接的发布者发出需求信号。 当它收到订阅者的需求时，它会向它连接的发布者发出 <code class="language-plaintext highlighter-rouge">unlimited</code> 需求信号。 虽然 subject 支持多个订阅者，但任何未请求数据的订阅者，在请求之前均不会给它们提供数据。</p><p>Combine 中有两种内建的 subject : <a href="https://heckj.github.io/swiftui-notes/#reference-currentvaluesubject">CurrentValueSubject</a> 和 <a href="https://heckj.github.io/swiftui-notes/#reference-passthroughsubject">PassthroughSubject</a>。 它们的行为类似，但不同的是 <code class="language-plaintext highlighter-rouge">CurrentValueSubject</code> 需要一个初始值并记住它当前的值，<code class="language-plaintext highlighter-rouge">PassthroughSubject</code> 则不会。 当调用 <code class="language-plaintext highlighter-rouge">.send()</code> 时，两者都将向它们的订阅者提供更新的值。</p><p>在给遵循 <a href="https://developer.apple.com/documentation/combine/observableobject"><code class="language-plaintext highlighter-rouge">ObservableObject</code></a> 协议的对象创建发布者时，<code class="language-plaintext highlighter-rouge">CurrentValueSubject</code> 和 <code class="language-plaintext highlighter-rouge">PassthroughSubject</code> 也很有用。 SwiftUI 中的多个声明式组件都遵循这个协议。</p><h2 id="订阅者"><span class="mr-2">订阅者</span><a href="#订阅者" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>虽然 <a href="https://developer.apple.com/documentation/combine/subscriber"><code class="language-plaintext highlighter-rouge">Subscriber</code></a> 是用于接收整个管道数据的协议，但通常 <em>the subscriber</em> 指的是管道的末端。</p><p>Combine 中有两个内建的订阅者： <a href="https://heckj.github.io/swiftui-notes/#reference-assign">Assign</a> 和 <a href="https://heckj.github.io/swiftui-notes/#reference-sink">Sink</a>。 SwiftUI 中有一个订阅者： <a href="https://heckj.github.io/swiftui-notes/#reference-onreceive">onReceive</a>。</p><p>订阅者支持取消操作，取消时将终止订阅关系以及所有流完成之前，由发布者发送的数据。 <code class="language-plaintext highlighter-rouge">Assign</code> 和 <code class="language-plaintext highlighter-rouge">Sink</code> 都遵循 <a href="https://developer.apple.com/documentation/combine/cancellable">Cancellable 协议</a>.</p><p>当你存储和自己订阅者的引用以便稍后清理时，你通常希望引用销毁时能自己取消订阅。 <a href="https://heckj.github.io/swiftui-notes/#reference-anycancellable">AnyCancellable</a> 提供类型擦除的引用，可以将任何订阅者转换为 <code class="language-plaintext highlighter-rouge">AnyCancellable</code> 类型，允许在该引用上使用 <code class="language-plaintext highlighter-rouge">.cancel()</code>，但无法访问订阅者本身（对于实例来说可以，但是需要更多数据）。 存储对订阅者的引用非常重要，因为当引用被释放销毁时，它将隐含地取消其操作。</p><p><a href="https://developer.apple.com/documentation/combine/subscribers/assign"><code class="language-plaintext highlighter-rouge">Assign</code></a> 将从发布者传下来的值应用到由 keypath 定义的对象， keypath 在创建管道时被设置。 一个在 Swift 中这样的例子：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">signupButton</span><span class="p">)</span>
</pre></table></code></div></div><p><a href="https://developer.apple.com/documentation/combine/subscribers/sink"><code class="language-plaintext highlighter-rouge">Sink</code></a> 接受一个闭包，该闭包接收从发布者发送的任何结果值。 这允许开发人员使用自己的代码终止管道。 此订阅者在编写单元测试以验证发布者或管道时也非常有帮助。 一个在 Swift 中这样的例子：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">receivedValue</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"The end result was </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">receivedValue</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>其他订阅者是其他 Apple 框架的一部分。 例如，SwiftUI 中的几乎每个 <code class="language-plaintext highlighter-rouge">control</code> 都可以充当订阅者。 SwiftUI 中的 <a href="https://developer.apple.com/documentation/swiftui/view/">View 协议</a> 定义了一个 <code class="language-plaintext highlighter-rouge">.onReceive(publisher)</code> 函数，可以把视图当作订阅者使用。 <code class="language-plaintext highlighter-rouge">onReceive</code> 函数接受一个类似于 <code class="language-plaintext highlighter-rouge">sink</code> 接受的闭包，可以操纵 SwiftUI 中的 <code class="language-plaintext highlighter-rouge">@State</code> 或 <code class="language-plaintext highlighter-rouge">@Bindings</code>。</p><p>一个在 SwiftUI 中这样的例子：</p><div class="language-swift highlighter-rouge"><div class="code-header"> <span data-label-text="Swift"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">MyView</span> <span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>

    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">currentStatusValue</span> <span class="o">=</span> <span class="s">"ok"</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">Text</span><span class="p">(</span><span class="s">"Current status: </span><span class="se">\(</span><span class="n">currentStatusValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">onReceive</span><span class="p">(</span><span class="kt">MyPublisher</span><span class="o">.</span><span class="n">currentStatusPublisher</span><span class="p">)</span> <span class="p">{</span> <span class="n">newStatus</span> <span class="k">in</span>
                <span class="k">self</span><span class="o">.</span><span class="n">currentStatusValue</span> <span class="o">=</span> <span class="n">newStatus</span>
            <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>对于任何类型的 UI 对象 (UIKit、AppKit 或者 SwiftUI)， <a href="https://heckj.github.io/swiftui-notes/#reference-assign">Assign</a> 可以在管道中使用来更新其属性。</p><h2 id="参考"><span class="mr-2">参考</span><a href="#参考" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><p><a href="https://www.raywenderlich.com/books/combine-asynchronous-programming-with-swift/v2.0">Combine: Asynchronous Programming with Swift</a></p><li><p><a href="https://heckj.github.io/swiftui-notes/">Using Combine</a></p></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ios/'>iOS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/combine/" class="post-tag no-text-decoration" >combine</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=iOS Combine：核心概念 - Zhiying&#39;s iOS Star&amp;url=https://zhiying-fan.github.io//posts/ios-combine-core-concepts/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=iOS Combine：核心概念 - Zhiying&#39;s iOS Star&amp;u=https://zhiying-fan.github.io//posts/ios-combine-core-concepts/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://zhiying-fan.github.io//posts/ios-combine-core-concepts/&amp;text=iOS Combine：核心概念 - Zhiying&#39;s iOS Star" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/english/">english</a> <a class="post-tag" href="/tags/map/">map</a> <a class="post-tag" href="/tags/combine/">combine</a> <a class="post-tag" href="/tags/library/">library</a> <a class="post-tag" href="/tags/localization/">localization</a> <a class="post-tag" href="/tags/pipeline/">pipeline</a> <a class="post-tag" href="/tags/test/">test</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ui-testing-using-page-object-model/"><div class="card-body"> <em class="timeago small" data-ts="1652356800" > 2022-05-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>使用 Page Object Model 来写 UI Test</h3><div class="text-muted small"><p> 随着 SwiftUI 的使用，使得现在写 UI Test 也更为容易了一些，一般的视图都能够被分离出来，单独拿出来进行测试。如果再加上 Page Object Model，那么将能够给写 UI Test 锦上添花。下面就来一探究竟吧。 本文的示例代码来自于 UI Testing using Page Object pattern in Swift 例子使用一个简单的登录界面，大家可以把它...</p></div></div></a></div><div class="card"> <a href="/posts/ios-pipeline-gitlab-using-fastlane/"><div class="card-body"> <em class="timeago small" data-ts="1653566400" > 2022-05-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>使用 Fastlane 在 GitLab 上搭建 Pipeline</h3><div class="text-muted small"><p> 最近在 GitLab 上面给一个新的工程搭建了一条 Pipeline，所做的事情就是每次有代码提交，都会自动运行测试、安全检查然后打包上传到 TestFlight 以供测试。本以为基本上跟着文档做就会很顺利，不过这过程中还是踩了一些坑的，所以这边记录下来整个过程，希望可以形成一个完整的操作手册，只要一步步来基本就能完成搭建。 1. 给自己的工程配置 Fastlane 使用 bundler...</p></div></div></a></div><div class="card"> <a href="/posts/ios-localization/"><div class="card-body"> <em class="timeago small" data-ts="1608033600" > 2020-12-15 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>iOS 项目国际化 Localization</h3><div class="text-muted small"><p> 随着 Apple 对多语言用户使用体验的不断提升，从 iOS13 开始用户可以在应用设置中单独设置区别于系统的语言，同时对于开发者来说，对于多语言的适配体验也在不断的得到提升，本文将逐步说明如何对 iOS 项目做国际化支持。 添加支持的语言 支持国际化的第一步是添加我们想要支持的语言，选中 Project - Info ，在 Localizations 下面可以添加语言。 如果项目...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/book-play-with-data-structure/" class="btn btn-outline-primary" prompt="Older"><p>读《大话数据结构》</p></a> <a href="/posts/book-ios-tdd-1/" class="btn btn-outline-primary" prompt="Newer"><p>读《iOS Test-Driven Development》（一）</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://zhiying-fan.github.io//posts/ios-combine-core-concepts/'; this.page.identifier = '/posts/ios-combine-core-concepts/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://zhiying.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/zhiying-fan">Zhiying Fan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/english/">english</a> <a class="post-tag" href="/tags/map/">map</a> <a class="post-tag" href="/tags/combine/">combine</a> <a class="post-tag" href="/tags/library/">library</a> <a class="post-tag" href="/tags/localization/">localization</a> <a class="post-tag" href="/tags/pipeline/">pipeline</a> <a class="post-tag" href="/tags/test/">test</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
